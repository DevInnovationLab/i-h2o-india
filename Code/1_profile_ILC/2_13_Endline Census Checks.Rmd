---
title: "Endline Census - High Frequency Check"
author: "Jeremy Lowe, Archi Gupta"
date: "`r Sys.Date()`"
output: 
  pdf_document:
    
knit: (function(inputFile, encoding) {
  rmarkdown::render(inputFile, encoding = encoding, output_dir = "C:/Users/jerem/Box/India Water project/2_Pilot/Data/1_raw/1_8_Endline") })
  
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE, include = TRUE, warning = FALSE, message = FALSE)


```

# Introduction

This RMarkdown document was created to perform high frequency data checks for the India ILC Endline Census in May 2024. This document was created to generate pdf reports, but it does not automatically sync to the online Overleaf Latex document.

Also, I could reference the 2_2_Checks.do file for the baseline census HFC, but this one for Follow-up R3 seems to have more variables captured

```{r package load}


# load the libraries
library(readxl) 
library(googledrive)
library(googlesheets4)
library(DBI)
library(RSQLite)
library(dplyr)
library(lubridate)
library(haven)
library(expss)
library(stargazer)
library(Hmisc)
library(ggplot2)
library(labelled)
library(data.table)

library(rsurveycto)
library(httr)
library(tidyverse)
library(lubridate)
library(quantitray)
library(sjmisc)
library(knitr)
library(kableExtra)
library(readxl)
library(experiment)
library(readxl)
library(haven)
library(ggsignif)
library(patchwork)
library(table1)
library(gtsummary)
#library(xtable)



```





```{r profile}
#------------------------ setting user path ----------------------------------------#


user_path <- function() {
  # Return a hardcoded path that depends on the current user, or the current 
  # working directory for an unrecognized user. If the path isn't readable,
  # stop.
  #
  
  user <- Sys.info()["user"]
  
  if (user == "asthavohra") { 
    path = "/Users/asthavohra/Library/CloudStorage/Box-Box/India Water project/2_Pilot/Data/"
  } 
  else if (user=="akitokamei"){
    path = "/Users/akitokamei/Box Sync/India Water project/2_Pilot/Data/"
  } 
  else if (user == "jerem"){
    path = "C:/Users/jerem/Box/India Water project/2_Pilot/Data/"
  } 
  else {
    warning("No path found for current user (", user, ")")
    path = getwd()
  }
  
  stopifnot(file.exists(path))
  return(path)
}

# set working directory
knitr::opts_knit$set(root.dir = user_path())

# setting github directory
github_path <- function() {
  user <- Sys.info()["user"]
  if (user == "asthavohra") {
    github = "/Users/asthavohra/Documents/GitHub/i-h2o-india/Code/2_Pilot/0_pilot logistics/"
  } 
  else if (user=="akitokamei"){
    github = "/Users/akitokamei/Library/CloudStorage/Dropbox/Mac/Documents/GitHub/i-h2o-india/Code/2_Pilot/0_pilot logistics/"
  } 
  else if (user == "jerem") {
    github = "C:/Users/jerem/Documents/i-h2o-india/Code/1_profile_ILC"
  } 
  else {
    warning("No path found for current user (", user, ")")
    github = getwd()
  }
  
  stopifnot(file.exists(github))
  return(github)
}

### setting overleaf ###
# This section was commented out because we are not using overleaf for this file yet
# overleaf <- function() {
#   user <- Sys.info()["user"]
#   if (user == "asthavohra") {
#     overleaf = "/Users/asthavohra/Dropbox/Apps/Overleaf/Everything document -ILC/"
#   } 
#   else if (user=="akitokamei"){
#     overleaf = "/Users/akitokamei/Library/CloudStorage/Dropbox/Apps/Overleaf/Everything document -ILC/"
#   } 
#   else if (user == "jerem") {
#     overleaf = ""
#   } 
#   else {
#     warning("No path found for current user (", user, ")")
#     overleaf = getwd()
#   }
#   
#   stopifnot(file.exists(overleaf))
#   return(overleaf)
# }




#Setting the output folder for the pdf report

#setwd("C:/Users/jerem/Documents/i-h2o-india/Code/1_profile_ILC")
#knitr::opts_knit$set(out.dir = "C:/Users/jerem/Box/India Water project/2_Pilot/Data/")




```





knit: (function(inputFile, encoding) {
  rmarkdown::render(inputFile, encoding = encoding, output_dir = paste0(user_path(),"1_raw/1_8_Endline/1_8_Endline_Census_cleaned.dta")) })

---

```{r loading data}
#------------------------ Load the data ----------------------------------------#

#df.temp <- read_stata(paste0(user_path(),"1_raw/1_8_Endline/1_8_Endline_Census.dta" ))

df.preload <- read_stata(paste0(user_path(),"99_Preload/1_8_Endline_XXX.dta"))


#Loading/saving most recent cleaned data
#Lazy coding, didn't want to change Astha's Stata code and break it yet

df.temp <- read_stata(paste0(user_path(),"1_raw/1_8_Endline/1_8_Endline_Census_cleaned.dta" ))






```



```{r defining functions}

labelmaker <- function(x){
  z <- colnames(x)
  for(i in z){
    labels <-  val_labels(x[i])
    if(is.na(labels) == FALSE){
      x[i] <- to_label(x[i])
      
    }
  }
  return(x)
}

```



```{r changing variable names}
#------------------------ Apply the labels for variables---------------------#

temp.labels <- lapply(df.temp , var_lab)

#create a data with labels
#Code from Astha
df.label <- as.data.frame(t(as.data.frame(do.call(cbind, temp.labels)))) 
df.label<- tibble::rownames_to_column(df.label) 
df.label <- df.label %>% rename(variable = rowname, label = V1)  
auto_generated_labels <- c(df.label$variable)

#include labels given manually 
df.label.manual <- read_xlsx(paste0(user_path(),"4_other/R_code_HH_Survey_labels.xlsx"))

df.var <- as.data.frame(names(df.temp)) #List of variables in the data

# assign labels to variable that were generated
#df.label.manual <- df.label.manual %>% 
 # mutate(new_var = ifelse(Variable %in% auto_generated_labels, 0,1)) %>% 
  #filter(new_var == 1) %>% 
  #select(-new_var) %>% 
  #rename(variable = Variable, label = Label)

#df.label <- rbind(df.label, df.label.manual)
# create a function that assigns the label to appropriate variable


#create a date variable
df.temp$datetime <- strptime(df.temp$R_E_starttime, format = "%Y-%m-%d %H:%M:%S")

df.temp$date <- as_date(df.temp$datetime) 

df.temp$End_date <- as_date(df.temp$End_date)

#filter out the testing dates
df.temp <- df.temp


```


```{r cleaning data}


#------------------------ Keep consented cases ----------------------------------------#

df.temp.consent <- df.temp[which(df.temp$R_E_consent==1) ,]


#------------ Assign the correct treatment to villages---------------------------#

df.temp.consent <- df.temp.consent %>% mutate(Treatment = ifelse(R_E_r_cen_village_name_str %in%
                                                                   c("Birnarayanpur","Nathma", "Badabangi","Naira", "Bichikote", "Karnapadu","Mukundpur", "Tandipur", "Gopi Kankubadi", "Asada"), "T", "C"))



#Using labelmaker to make transfer labels for the whole dataset
df.temp <- labelmaker(df.temp)
df.temp.consent <- labelmaker(df.temp.consent)





```



# Endline Census Progress Tables


```{r progress tables}
#------------------------ Progress table ----------------------------------------#

submissions <- df.temp  %>% 
  dplyr::select(R_E_r_cen_village_name_str) %>%
  group_by(R_E_r_cen_village_name_str) %>% mutate(Submission=n()) %>% ungroup()  %>% unique() %>% 
  arrange(R_E_r_cen_village_name_str)

resp_available <- df.temp %>%  
  filter(R_E_resp_available == "Household available for an interview and opened the door") %>% 
  dplyr::select(R_E_r_cen_village_name_str) %>%
  group_by(R_E_r_cen_village_name_str) %>% 
  mutate("OG Found" =n()) %>%
  ungroup()%>%
  unique() %>%
  arrange(R_E_r_cen_village_name_str)

resp_notavailable <- df.temp %>%
  filter(R_E_resp_available != "Household available for an interview and opened the door"  ) %>% 
  dplyr::select(R_E_r_cen_village_name_str) %>%
  group_by(R_E_r_cen_village_name_str) %>%
  mutate("NOT Found" =n()) %>%
  ungroup()  %>% 
  unique() %>% 
  arrange(R_E_r_cen_village_name_str)

consented <- df.temp  %>% 
  filter(R_E_consent == "Yes") %>%
  dplyr::select(R_E_r_cen_village_name_str) %>%
  group_by(R_E_r_cen_village_name_str) %>%
  mutate(Consented=n()) %>%
  ungroup()  %>% 
  unique() %>% 
  arrange(R_E_r_cen_village_name_str)

audio_consent <- df.temp  %>% 
  filter(R_E_audio_consent == "Yes") %>%
  dplyr::select(R_E_r_cen_village_name_str) %>%
  group_by(R_E_r_cen_village_name_str) %>%
  mutate(audio_consent=n()) %>%
  ungroup()  %>% 
  unique() %>% 
  arrange(R_E_r_cen_village_name_str)

refused <- df.temp %>% 
  filter(R_E_consent != "Yes") %>%
  dplyr::select(R_E_r_cen_village_name_str) %>%
  group_by(R_E_r_cen_village_name_str) %>%
  mutate(Refused=n()) %>%
  ungroup()  %>% 
  unique() %>% 
  arrange(R_E_r_cen_village_name_str)

#No replacements used during the census - removing this code
# replacements <- df.temp %>% 
#   filter( R_E_replacement == 1 ) %>% 
#   dplyr::select(R_E_r_cen_village_name_str) %>%
#   group_by(R_E_r_cen_village_name_str) %>% 
#   mutate(Replacements=n()) %>% 
#   ungroup()  %>%
#   unique() %>% 
#   arrange(R_E_r_cen_village_name_str)

df.progress <- left_join(submissions,resp_available)%>% 
  left_join(resp_notavailable) %>% 
  #left_join(replacements) %>% 
  left_join(consented) %>% 
  left_join(audio_consent)%>%
  left_join(refused)  %>% 
  rename(Village = R_E_r_cen_village_name_str)

df.progress[is.na(df.progress)]<-0

#Marking total progress in a table
Total <- df.progress %>% 
  summarise(across(where(is.numeric), ~ sum(.x, na.rm = TRUE)))

Total$Village <- "Total"
df.progress<- rbind(df.progress, Total)


#Instead of using Stargazer tables, I'm going to use Kable outputs so it can print to pdf easily

#output to tex 
#stargazer(df.progress, summary=F, title= "Overall Progress: Follow Up Round 1 HH #Survey",float=F,rownames = F,
 #         covariate.labels=NULL, 
          #out=paste0(overleaf(),"Table/Table_Progress_HH_Survey_R3.tex")
#)

#df.temp$date <- format(as.Date(df.temp$R_E_starttime, "%Y-%m-%d %H:%M:%S"), "%Y-%m-%d")



#Representing overall progress in a Kable output

kbl(df.progress)%>%
  kable_styling(bootstrap_options = "striped", full_width = TRUE) %>%
  add_header_above(c("Overall Progress - Endline Census " = 7)) %>%
  row_spec(0, bold = TRUE, color = "black", background = "white") %>%
  column_spec(1, bold = TRUE) %>%
  column_spec(2, width = "75px")


#Representing Progress in Table1 output

table1(data = df.temp, ~ R_E_resp_available + R_E_consent + R_E_audio_consent)




```

\newpage


# Enumerator Productivity


```{r enumerator productivity tables}

#------------------------ Distribution of surveys by dates & villages --------------------#
date.plt<- df.temp %>% filter(R_E_consent == "Yes") %>%
  filter(date >= as.Date("2024-04-15")) %>%
  group_by( R_E_r_cen_village_name_str, date) %>%
  dplyr::summarise(Date_N=n()) %>%
  ungroup()


# CONVERT TO TABLE
tab <- spread(date.plt,key = "date", value = "Date_N")
tab <- tab %>% dplyr::mutate(total=rowSums(across(-1),na.rm = T))
tab[is.na(tab)] <- 0 
tab <- tab %>% rename(Village = R_E_r_cen_village_name_str)

#Printing kable of surveys in village by specific dates
i <- length(tab)
kbl(tab)%>%
  kable_styling(bootstrap_options = "striped", full_width = TRUE) %>%
  add_header_above(c("Overall Progress - Endline Census " = i)) %>%
  row_spec(0, bold = TRUE, color = "black", background = "white") %>%
  column_spec(1, bold = TRUE) %>%
  column_spec(2, width = "75px")

#Old stargazer table format
#stargazer(tab,out= paste0(overleaf(), "Table/Table_survey_by_date_village_R3.tex"), summary=F, float=F,rownames = F, covariate.labels=NULL)


#------------------------ Distribution of surveys by Enumerator, villages ----------------------------------------#

date.plt<- df.temp %>% 
  filter(R_E_consent == "Yes")%>%
  filter(date >= as.Date("2024-04-15")) %>%
  group_by( R_E_r_cen_village_name_str, R_E_enum_name_label) %>%
  dplyr:: summarise(Date_N=n()) %>%
  ungroup()


# CONVERT TO TABLE
tab<- spread(date.plt,key = "R_E_r_cen_village_name_str", value = "Date_N")
tab <- tab %>% dplyr::mutate(total=rowSums(across(-c(1)),na.rm = T))
tab[is.na(tab)] <- 0 
tab <- tab %>% rename(Enumerator =R_E_enum_name_label  )


#Printing Kable output
i <- length(tab)
kbl(tab)%>%
  kable_styling(bootstrap_options = "striped", full_width = TRUE) %>%
  add_header_above(c("Overall Enumerator Progress - Endline Census " = i)) %>%
  row_spec(0, bold = TRUE, color = "black", background = "white") %>%
  column_spec(1, bold = TRUE) %>%
  column_spec(2, width = "75px")


#Old stargazer table
#stargazer(tab,out= paste0(overleaf(), "Table/Table_survey_by_enum_date_village_R3.tex"), summary=F, float=F,rownames = F, covariate.labels=NULL)


#------------------------  Enumerator: duration for each section and count of DK ----------------------------------------#


# 1. Duration by enumerators
#understanding which variables are duration variables to correct the code below
#x <- df.temp.consent%>% 
 # dplyr::select(contains("dur"))


consent_dur_enum <- df.temp.consent %>% filter(date >= as.Date("2024-04-15")) %>%
  group_by(R_E_enum_name_label) %>%
  dplyr:: summarise("Consent" = round(mean(as.numeric(R_E_consent_duration)),1)) %>% ungroup()

intro_dur_enum <- df.temp.consent %>% filter(date >= as.Date("2024-04-15")) %>%
  group_by(R_E_enum_name_label) %>%
  dplyr:: summarise("Intro" = round(mean(as.numeric(R_E_intro_dur_end)),1)) %>% ungroup()

wash_dur_enum <- df.temp.consent %>% filter(date >= as.Date("2024-04-15")) %>%
  group_by(R_E_enum_name_label) %>%
  dplyr:: summarise("WASH" = round(mean(as.numeric(R_E_wash_duration)),1)) %>% ungroup()

healthcare_dur_enum <- df.temp.consent %>% filter(date >= as.Date("2024-04-15")) %>%
  group_by(R_E_enum_name_label) %>%
  dplyr:: summarise("Healthcare Expenditure" = round(mean(as.numeric(R_E_healthcare_duration)),1)) %>% ungroup()

resphealth_dur_enum <- df.temp.consent %>% filter(date >= as.Date("2024-04-15")) %>%
  group_by(R_E_enum_name_label) %>%
  dplyr:: summarise("Resp Health" = round(mean(as.numeric(R_E_resp_health_duration)),1)) %>% ungroup()

chealth_dur_enum <- df.temp.consent %>% filter(date >= as.Date("2024-04-15")) %>%
  group_by(R_E_enum_name_label) %>%
  dplyr:: summarise("Child Health" = round(mean(as.numeric(R_E_child_census_duration)),1)) %>% ungroup()

end_dur_enum <- df.temp.consent %>% filter(date >= as.Date("2024-04-15")) %>%
  group_by(R_E_enum_name_label) %>%
  dplyr:: summarise("Survey End" = round(mean(as.numeric(R_E_survey_end_duration)),1)) %>% ungroup()


df.duration.enum <- left_join(consent_dur_enum,intro_dur_enum, by="R_E_enum_name_label") %>% 
  left_join(wash_dur_enum) %>% 
  left_join(healthcare_dur_enum) %>% 
  left_join(resphealth_dur_enum) %>% 
  left_join(chealth_dur_enum) %>%
  left_join(end_dur_enum)
df.duration.enum[,2:8] <- round(df.duration.enum[,2:8]/60,1) #converting to minutes
df.duration.enum <- df.duration.enum %>% rename(Enumerator = R_E_enum_name_label)


#Kable Output
kbl(df.duration.enum)%>%
  kable_styling(bootstrap_options = "striped", full_width = TRUE) %>%
  add_header_above(c("Enumerator Survey Duration - Endline Census " = 8)) %>%
  row_spec(0, bold = TRUE, color = "black", background = "white") %>%
  column_spec(1, bold = TRUE) %>%
  column_spec(2, width = "75px")


#Old Stargazer table
#star.out <- stargazer(df.duration.enum, summary=F, title= "Duration by section Follow Up R3 HH Survey by enumerator",float=F,rownames = F,covariate.labels=NULL)
#star.out <- sub("cccccccc", "lccccccc", star.out)
#starpolishr::star_tex_write(star.out,  file =paste0(overleaf(),"Table/Table_Duration_enum_HH_Survey_R3.tex"))




#--------------------------------------------------------------------------#




#2. Count of Dont Know by enumerators 

df.dk.enum <- df.temp.consent %>% filter(date >= as.Date("2024-04-15")) %>%
  group_by(R_E_enum_name_label) %>%
  summarise_all(~sum(. == 999)) %>% 
  transmute(R_E_enum_name_label, sum_dk = rowSums(.[-1], na.rm = T)) %>% 
  rename(Enumerator = R_E_enum_name_label, "Count of DK" = sum_dk)

#Kable Output
kbl(df.dk.enum)%>%
  kable_styling(bootstrap_options = "striped", full_width = TRUE) %>%
  add_header_above(c("Enumerator 999 Don't Know Use - Endline Census " = 2)) %>%
  row_spec(0, bold = TRUE, color = "black", background = "white") %>%
  column_spec(1, bold = TRUE) %>%
  column_spec(2, width = "75px")


#Old stargazer table
#stargazer(df.dk.enum, summary=F, title= "Count of DK by enumerator",float=F,rownames = F,         covariate.labels=NULL, out=paste0(overleaf(),"Table/Table_DK_enum_HH_Survey_R3.tex"))

#3. Count of 888 by enumerators for 24-7 filter

df.888.enum <- df.temp.consent %>% filter(date >= as.Date("2024-04-15")) %>%
  group_by(R_E_enum_name_label) %>%
  summarise_all(~sum(. == 888)) %>% 
  transmute(R_E_enum_name_label, sum_dk = rowSums(.[-1], na.rm = T)) %>% 
  rename(Enumerator = R_E_enum_name_label, "Count of 888" = sum_dk)

#Kable Output
kbl(df.888.enum)%>%
  kable_styling(bootstrap_options = "striped", full_width = TRUE) %>%
  add_header_above(c("Enumerator 888 Use - Endline Census " = 2)) %>%
  row_spec(0, bold = TRUE, color = "black", background = "white") %>%
  column_spec(1, bold = TRUE) %>%
  column_spec(2, width = "75px")


#Old stargazer output
#stargazer(df.888.enum, summary=F, title= "Count of DK by enumerator",float=F,rownames = F,          covariate.labels=NULL, out=paste0(overleaf(),"Table/Table_888_enum_HH_Survey_R3.tex"))




#4. Count of 666 used by enumerators across all

df.666.enum <- df.temp.consent %>% filter(date >= as.Date("2024-04-15")) %>%
  group_by(R_E_enum_name_label) %>%
  summarise_all(~sum(. == 666)) %>% 
  transmute(R_E_enum_name_label, sum_dk = rowSums(.[-1], na.rm = T)) %>% 
  rename(Enumerator = R_E_enum_name_label, "Count of 666" = sum_dk)

#Kable Output
kbl(df.666.enum)%>%
  kable_styling(bootstrap_options = "striped", full_width = TRUE) %>%
  add_header_above(c("Enumerator 666 Use - Endline Census " = 2)) %>%
  row_spec(0, bold = TRUE, color = "black", background = "white") %>%
  column_spec(1, bold = TRUE) %>%
  column_spec(2, width = "75px")




```


# Key Variables


```{r overall variable checks}

#------------------------  Overall checks ------------------------  

#1 Duration of each section


consent_dur_enum <- df.temp.consent %>% filter(date >= as.Date("2024-04-15")) %>%
  dplyr:: summarise(mean = round(mean(as.numeric(R_E_consent_duration)),1), min = round(min(as.numeric(R_E_consent_duration)),1), max = round(max(as.numeric(R_E_consent_duration)),1))  %>%
  mutate(variable = "Consent")

intro_dur_enum <- df.temp.consent %>% filter(date >= as.Date("2024-04-15")) %>%
  dplyr:: summarise(mean = round(mean(as.numeric(R_E_intro_dur_end)),1), min = round(min(as.numeric(R_E_intro_dur_end)),1), max = round(max(as.numeric(R_E_intro_dur_end)),1))  %>%
  mutate(variable = "Intro")

wash_dur_enum <- df.temp.consent %>% filter(date >= as.Date("2024-04-15")) %>%
  dplyr:: summarise(mean = round(mean(as.numeric(R_E_wash_duration)),1), min = round(min(as.numeric(R_E_wash_duration)),1), max = round(max(as.numeric(R_E_wash_duration)),1))  %>%
  mutate(variable = "WASH")

healthcare_dur_enum <- df.temp.consent %>% filter(date >= as.Date("2024-04-15")) %>%
  dplyr:: summarise(mean = round(mean(as.numeric(R_E_healthcare_duration)),1), min = round(min(as.numeric(R_E_healthcare_duration)),1), max = round(max(as.numeric(R_E_healthcare_duration)),1))  %>%
  mutate(variable = "Healthcare Expenditure")


resphealth_dur_enum <- df.temp.consent %>% filter(date >= as.Date("2024-04-15")) %>%
  dplyr:: summarise(mean = round(mean(as.numeric(R_E_resp_health_duration)),1), min = round(min(as.numeric(R_E_resp_health_duration)),1), max = round(max(as.numeric(R_E_resp_health_duration)),1))  %>%
  mutate(variable = "Respondent Health")

chealth_dur_enum <- df.temp.consent %>% filter(date >= as.Date("2024-04-15")) %>%
  dplyr:: summarise(mean = round(mean(as.numeric(R_E_child_census_duration)),1), min = round(min(as.numeric(R_E_child_census_duration)),1), max = round(max(as.numeric(R_E_child_census_duration)),1))  %>%
  mutate(variable = "Child Health")

end_dur_enum <- df.temp.consent %>% filter(date >= as.Date("2024-04-15")) %>%
  dplyr:: summarise(mean = round(mean(as.numeric(R_E_survey_end_duration)),1), min = round(min(as.numeric(R_E_survey_end_duration)),1), max = round(max(as.numeric(R_E_survey_end_duration)),1))  %>%
  mutate(variable = "Survey End")

df.duration <- bind_rows(consent_dur_enum, intro_dur_enum, wash_dur_enum, healthcare_dur_enum, resphealth_dur_enum, chealth_dur_enum, end_dur_enum)
df.duration[,1:3] <- df.duration[,1:3]/60 #converting to minutes

df.duration <- df.duration %>% dplyr::select(variable , mean, min, max) %>% mutate(mean = round(mean, 1), min = round(min, 1), max = round(max, 1)) %>%   rename("Duration\ Section" = variable, "Mean \ (in mins)" = mean, "Min \ (in mins)" = min, "Max \ (in mins)" = max ) 


#Kable Output
kbl(df.duration)%>%
  kable_styling(bootstrap_options = "striped", full_width = TRUE) %>%
  add_header_above(c("Overall Survey Duration - Endline Census " = 4)) %>%
  row_spec(0, bold = TRUE, color = "black", background = "white") %>%
  column_spec(1, bold = TRUE) %>%
  column_spec(2, width = "75px")




#------------------------ Special Checks ------------------------  


#Counting people accompanying to shadow enumerators
df.shadow <- df.temp.consent %>% filter(date >= as.Date("2024-04-15")) %>%   dplyr::select(R_E_enum_name_label,R_E_r_cen_village_name_str, R_E_a42_survey_accompany_num) %>%
  group_by(R_E_enum_name_label) %>% 
  dplyr:: summarise(mean = round(mean(R_E_a42_survey_accompany_num),1), 
                    min = round(min(R_E_a42_survey_accompany_num),1), max = round(max(R_E_a42_survey_accompany_num),1)) %>%
  rename(Enumerator = R_E_enum_name_label) 

#Kable Output
kbl(df.shadow)%>%
  kable_styling(bootstrap_options = "striped", full_width = TRUE) %>%
  add_header_above(c("Enumerator Shadow Count - Endline Census " = 4)) %>%
  row_spec(0, bold = TRUE, color = "black", background = "white") %>%
  column_spec(1, bold = TRUE) %>%
  column_spec(2, width = "75px")

#Old stargazer output
#stargazer(df.shadow, summary=F, title= "Check instances of shadowing of enumerators during survey, by enumerator, by village",float=F,rownames = F,         covariate.labels=NULL, out=paste0(overleaf(),"Table/Table_shadow_HH_Survey_R3.tex"))


#Summarizing a few key village characteristics -- number of households member and visit #

df.temp.consent$R_E_cen_num_hhmembers <- as.numeric(df.temp.consent$R_E_cen_num_hhmembers)
df.temp.consent$R_E_cen_num_childbelow5 <- as.numeric(df.temp.consent$R_E_cen_num_childbelow5)
df.temp.consent$R_E_visit_num <- to_label(df.temp.consent$R_E_visit_num)


tab <- df.temp.consent %>% filter(date >= as.Date("2024-04-15")) %>%
  dplyr::select(R_E_enum_name_label,R_E_r_cen_village_name_str, R_E_cen_num_hhmembers, R_E_cen_num_childbelow5, R_E_visit_num, R_E_n_new_members, R_E_n_hhmember_count, R_E_n_num_allmembers_h, R_E_n_num_childbelow5) %>%
  rename(Visit_Number = R_E_visit_num,
         Number_of_children = R_E_cen_num_childbelow5,
         Number_of_HH_members = R_E_cen_num_hhmembers)

table1(data = tab, ~ R_E_enum_name_label + Visit_Number + Number_of_children + Number_of_HH_members + R_E_n_new_members + R_E_n_hhmember_count + R_E_n_num_childbelow5)


#Summarizing comparison of respondent names between baseline and endline

#df.temp.consent$R_E_r_cen_a1_resp_name
#df.temp.consent$R_E_cen_resp_name
#df.temp.consent$R_E_cen_resp_label
#df.temp.consent$R_E_n_new_members
#df.temp.consent$R_E_n_num_allmembers_h







# WASH Questions ----------------------------------------------#





#JJM drinking from tap
#tab <- df.temp.consent%>%
 # dplyr::select(R_E_r_cen_village_name_str, R_E_jjm_drinking)%>%
  #group_by(R_E_r_cen_village_name_str) %>% 
  #dplyr::summarise(mean = round(mean(R_E_jjm_drinking),2), 
   #                 ) %>%
  #rename(Village = R_E_r_cen_village_name_str, JJM_Drinking_Percent = mean)
#Kable Output
#kbl(tab)%>%
 # kable_styling(bootstrap_options = "striped", full_width = FALSE) %>%
  #add_header_above(c("JJM Drinking from Tap - Endline Census " = 2)) %>%
  #row_spec(0, bold = TRUE, color = "black", background = "white") %>%
  #column_spec(1, bold = TRUE) %>%
  #column_spec(2, width = "75px")


#Selecting WASH Variables and cleaning
tab <- df.temp.consent%>%
  dplyr::select(R_E_r_cen_village_name_str, R_E_jjm_drinking, R_E_jjm_yes, R_E_jjm_stored, R_E_jjm_use__77, R_E_jjm_use_999, R_E_tap_issues, R_E_tap_issues_type__77, R_E_tap_issues_type_1, 
                R_E_water_source_prim, R_E_water_source_kids, R_E_water_prim_source_kids, R_E_water_source_preg,  R_E_water_prim_source_preg, R_E_quant, 
                R_E_sec_source_reason_999, R_E_sec_source_reason__77, R_E_water_sec_yn, R_E_water_sec_freq, R_E_water_treat, R_E_water_treat_kids, R_E_water_treat_type__77, R_E_water_treat_type_999, R_E_water_treat_freq__77, R_E_water_stored)%>%
  rename(Village = R_E_r_cen_village_name_str)



#Primary Source Use

#summarizing categories
#tab <- tab%>%
 # group_by(Village, R_E_water_source_prim) %>% 
  #dplyr::summarise(n = n()
   #                 ) %>%
  #mutate(freq = n / sum(n))%>%
  #rename(Primary_Water_Source_Percent = freq)

#Summarizing using gt_summary()
# tab_2 <-tab%>%
#   dplyr::select(Village, R_E_water_source_prim) %>%
#   tbl_summary()%>%
#   add_n() %>%
#   as_kable_extra()
# #Outputting Kable
# tab_2%>%
#   kable_styling(bootstrap_options = "striped", full_width = FALSE) %>%
#   add_header_above(c("JJM Drinking from Tap - Endline Census " = 3)) %>%
#   row_spec(0, bold = TRUE, color = "black", background = "white") %>%
#   column_spec(1, bold = TRUE) %>%
#   column_spec(2, width = "75px")

#Table1 Output
table1(data = tab, ~ R_E_water_source_prim + R_E_water_source_kids + R_E_water_source_preg + R_E_quant)

#JJM Taps
#Table1 Output
table1(data = tab, ~ R_E_jjm_drinking + R_E_jjm_yes + R_E_jjm_stored + R_E_jjm_use__77 + R_E_jjm_use_999 + R_E_tap_issues+ R_E_tap_issues_type__77 + R_E_tap_issues_type_1)


#Secondary Source Use
#

#Update secondary source variables
tab$R_E_sec_source_reason_999 <- factor(tab$R_E_sec_source_reason_999)
tab$R_E_sec_source_reason__77 <- factor(tab$R_E_sec_source_reason__77)

#Table1 output
table1(data = tab, ~ R_E_water_sec_yn + R_E_water_sec_freq + R_E_sec_source_reason_999 + R_E_sec_source_reason__77)








```


```{r}

```




# For later reference, 2_2_Checks.do code

https://github.com/DevInnovationLab/i-h2o-india/blob/Stem/Code/1_profile_ILC/2_2_Checks.do


