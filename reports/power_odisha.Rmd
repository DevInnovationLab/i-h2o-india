---
title: "Power Considerations for Village RCT Odisha"
author: Alex Lehner, May2023
#bibliography: alex_india.bib
#output: html_notebook
output:
  pdf_document: default
  dev: cairo_pdf
---

Questions unresolved:
- which villages have the SVS scheme?
- district mortality from latest DHS
- U2MR goes from 120 to 90 in Kano (from U5), so 
- eyeball U2MR as 65 now

Based on early back-of-the-envelope I recommended 1 to 3k villages needed for randomization. Then I did more sophisticated calculations where I showed what happens if we go to all villages in one district



```{r setup, include=FALSE}
# the raw data is first extracted and transformed in the dataclean file
# the code for the analysis was first tested in the nigeria_DHS_extraction_analysis.R script
knitr::opts_chunk$set(echo = FALSE, eval = TRUE, include = FALSE, warning = FALSE, message = FALSE)
rm(list = ls())
library(sf)
library(rnaturalearth)
library(tmap)
library(stars)
library(tidyverse)

# from meta_helpers.R file:
back_out_MDE_reduction_2proptest_cluster <- function(n_cluster, n_per_cluster, MR, power_choice = .8, ICC_choice = .01, ...) {
  # i wanna get out the MDE, like in the individual case
  # first i compute the proportion that I can detect, given parameters
  # https://rdrr.io/cran/clusterPower/man/cpa.binary.html
  # we could also build in a CV for clustersize if wanted
  # BUG IN EARLY VERSIONS IN NOVEMBER: ncluster is PER condition, so it has to be divided 2
  # Jun2023: passed over the power_choice correctly into the cpa.binary (never wanted to do anything else than 80% before)
  power.out <- clusterPower::cpa.binary(nclusters = n_cluster/2, nsubjects = n_per_cluster, ICC = ICC_choice, p1 = MR, p1inc = TRUE, power = power_choice,
                                        tol = .Machine$double.eps^.5, ...)
  # just back out the MDE now
  (1 - power.out[[1]] / MR) * 1e2
}

# loading and selecting of variables + subsetting
odisha2011 <- readRDS("odisha_interactive/Odisha2011_points.rds")
odisha2011 <- odisha2011 |> dplyr::select(-(1:3))
odisha.dists <- unique(odisha2011$dist_name) |> sort()
namesselect <- names(odisha2011)[6:12]
odisha2011$dist_name <- str_to_lower(odisha2011$dist_name)

dhs19 <- read_csv("odisha_interactive/astha_dhs2019.csv")
dhs19 <- dhs19[1:(nrow(dhs19)-3), ]

selected_distr <- c("Rayagada", "Kandhamal", "nabarangapur", "Kalahandi") |> str_to_lower()
dhs19 <- dhs19[dhs19$District %in% selected_distr, ]
dhs19 <- dhs19 |> select(District, `Percentage of preg women in district`)
names(dhs19)[2] <- "perc_preg"

# compute aggregates
odishasum <- odisha2011 |> st_drop_geometry() |> group_by(dist_name) |> 
  summarise(avg_hh_per_vil = mean(pc11_pca_no_hh),
            avg_u6_per_vil = mean(P_06), # July 3rd, add U6 from village census abstract
            CV_u6_per_vil  = sd(P_06) / mean(P_06),
            num_hh = sum(pc11_pca_no_hh),
            tot_pop = sum(pc11_pca_tot_p),
            num_vil = n())
# select relevant districts
odishasum <- odishasum[odishasum$dist_name %in% selected_distr, ]

odishasum <- left_join(odishasum, dhs19, by = c("dist_name" = "District")) # merge
# pregnant women - levels
odishasum$avg_preg_per_vil <- round(odishasum$avg_hh_per_vil * (odishasum$perc_preg/100), 2)
odishasum$ss_if_all_vil_visited <- odishasum$avg_preg_per_vil * odishasum$num_vil

# add U2 U5MR, perc water cover and perc SVS
# ... first, reorder to the order in one of the GDocs (https://docs.google.com/spreadsheets/d/1876Ut6NbNp-tCwECXbtC4v6JQ0V_GG1F/edit#gid=1567497203)
# ... so that I can 
odishasum <- odishasum[order(match(odishasum$dist_name, c("rayagada", "kandhamal", "nabarangapur", "kalahandi"))), ]

# put that in by hand from astha's sheet
odishasum$U5MR_23        <- c(83.67, 59.68, 55.16, 48.86)
odishasum$perc_tapwater  <- c(47.31, 41.36, 62.94, 49.89)
odishasum$perc_SVS_solar <- c(22.8, 58.7, 54, 74.8)
odishasum$perc_SVS       <- c(11.4, 35.4, 54, 60.6)

odishasum$U2MR_23 <- odishasum$U5MR_23 * 0.914 # rough approximation to get at U2MR from Akito

# reorder alphabetically
odishasum <- odishasum[order(odishasum$dist_name), ]


# calculate APPROXIMATE number of households that would qualify
odishasum$num_hh_SVS <- odishasum$num_hh * (odishasum$perc_SVS_solar / 100)
odishasum$num_vil_SVS <- odishasum$num_vil * (odishasum$perc_SVS_solar / 100)

# want to plug in the number of mothers per  [[1]]

# this is an approximate first shot, what would be the MDE, if the whole district would be visitied
odishasum_SVSsubs <- odishasum |> dplyr::select(dist_name, num_vil_SVS, avg_preg_per_vil, U2MR_23, avg_u6_per_vil, CV_u6_per_vil)
odishasum_SVSsubs$MDE_fulldistr <- NA
# this should be either 2 or 5:
studylength <- 2 # in years
for (i in 1:nrow(odishasum_SVSsubs)) {
  print(i)
  odishasum_SVSsubs$MDE_fulldistr[[i]] <- back_out_MDE_reduction_2proptest_cluster(
    n_cluster = odishasum_SVSsubs$num_vil_SVS[[i]], 
    n_per_cluster = odishasum_SVSsubs$avg_preg_per_vil[[i]] * studylength,  # MULTIPLY BY TWO FOR A TWO YEAR STUDY (very approx!!)
    MR = odishasum_SVSsubs$U2MR_23[[i]]/1e3, 
    ICC = 0.01) |> round(2)
}

odishasum_SVSsubs$num_vil_SVS <- round(odishasum_SVSsubs$num_vil_SVS)

# now we do the same for 800 villages
odishasum_SVSsubs$MDE_800vil <- NA
for (i in 1:nrow(odishasum_SVSsubs)) {
  print(i)
  odishasum_SVSsubs$MDE_800vil[[i]] <- back_out_MDE_reduction_2proptest_cluster(
    n_cluster = 800, 
    n_per_cluster = odishasum_SVSsubs$avg_preg_per_vil[[i]] * studylength,  # MULTIPLY BY TWO FOR A TWO YEAR STUDY (very approx!!)
    MR = odishasum_SVSsubs$U2MR_23[[i]]/1e3, 
    ICC = 0.01) |> round(2)
}

odishasum_SVSsubs$MDE_800vil[odishasum_SVSsubs$num_vil_SVS < 800] <- NA

knitr::kable(odishasum_SVSsubs, format = "simple")

```


# full MDEs

now we want the weighted U2 MR

```{r}
# can we get a number of villages in india to match the c. 9% raw MDE from the gw proposal?

odishasum_SVSsubs$num_vil_weighted <- odishasum_SVSsubs$U2MR_23 * (odishasum_SVSsubs$num_vil_SVS / sum(odishasum_SVSsubs$num_vil_SVS))

# do a uniform weighted U2MR and add villages

# do a 2 year and a 5 year, take into account the older kids at initial?

# now we take kalahandi and nabarangpur

odishasum_SVSsubs_2dist <- odishasum_SVSsubs[odishasum_SVSsubs$dist_name %in% c("kalahandi", "nabarangapur"), ]

vil_agg <- sum(odishasum_SVSsubs_2dist$num_vil_SVS)
n_preg_weighted <- weighted.mean(odishasum_SVSsubs_2dist$avg_preg_per_vil, odishasum_SVSsubs_2dist$num_vil_SVS)
U2MR_weighted <- weighted.mean(odishasum_SVSsubs_2dist$U2MR_23, odishasum_SVSsubs_2dist$num_vil_SVS)


# then do the calc
 back_out_MDE_reduction_2proptest_cluster(
    n_cluster = vil_agg, 
    n_per_cluster = n_preg_weighted * studylength,  # MULTIPLY BY TWO FOR A TWO YEAR STUDY (very approx!!)
    MR = U2MR_weighted/1e3, 
    ICC = 0.01) |> round(2)

```


# Diarrhea Powercalculations for Odisha Pilot

We have district level diarrhea incidence from an NFHS survey. Not for the geolocalised DHS clusters yet (h11 variable), this would allow us to do simulations and see how much variation we can partial out with a block fixed effect.

```{r}
# CONVERSATION ON SLACK on Jun 27th (evening) + Jun 28th (morning)

# @Alex Lehner
#  Michael would like to see power calculations for India for Phase 1 RCT. Can you re-run those as powered for diarrhea at 90% power? My understanding is that in the past you use UP data, but we are now working on Odisha. This is quite urgent just to have a sense whether what we proposed (150 villages, 75 T, 75 C) will be enough. CC-ing 
# @Akito
#  
# @Akanksha Saletore
#  
# @Michelle Cherian
#  FYI
# 
# Alex Lehner
# :airplane:  21 hours ago
# Hi 
# @Elisa Maffioli
# , I never did power calculations on diarrhea, only mortality. I found district wise diarrhea rates in this sheet, they are roughly 5% - which seems very low. Probably this is because the question asked is “did your child have diarrhea in the last two weeks” or something. So which baseline diarrhea rate to pick depends now on how often you plan to survey or how far back to include diarrhea incidence. Do you have a sense for that? Also, do you know details about randomization, e.g. stratification by block etc? (cc 
# @Witold Więcek
# ) Edit: I did have a conversation with Michael on that a while back and we concluded that the best would be to go just above the level of where we can implement ILC (the village?) and then stratify at that level (i.e. having a block of 2 or more villages and randomize within that. The question is whether these villages can be adjacent to each other (spillovers, IRB concerns, etc?) or there have been any other updates on that due to field visits etc? (edited) 
#                                                                                                                                                                                                                      
# Hi 
# @Alex Lehner
#  thanks! Can you do power calcs on 3 separate districts (Rayagada, Khandamal, and Kalahandi and then a mean between those) - even tough basically is either 4 or 5% all the time? Level of randomization is village level. Lets assume no stratification for now. We usually ask diarrhea in 2 weeks prior (or even 1 week) but whatever we have the data for is OK right now. Right now we are planning to follow-up 3 times? 
# @Akanksha Saletore
#  can you confirm this is correct and consistent with JPAL assumptions? 
# @Michelle Cherian
#  
# @Akanksha Saletore
#  
# @Astha Vohra
#  do you remember how we come up with 150 villages (I remember originally was 80, then 100 and then to be saved 150 for IRB) but I do not remember how we started at 80 if no one has run power calcs. Thanks a lot! (edited) 
# 
# 
# Elisa Maffioli
#   19 hours ago
# Can someone look in Amy's paper on Bangladesh and share what is the reduction she found? We can assume that as MDE. 
# @Michelle Cherian
#  
# @Akanksha Saletore
# 
# 
# Michelle Cherian
#   17 hours ago
# Hi 
# @Alex Lehner
#  
# @Elisa Maffioli
#  yes the diarrhea estimates from NFHS are prevalence rates 2 weeks before the survey. We unfortunately don't have annual estimates. The Odisha state govt does have such data but we're waiting for approvals to come through so that we can have access to that data. I just checked Amy Pickering's paper from Bangladesh and the reduction in diarrhea among children who get chlorinated water is 2.5 pp (7.5% treatment vs 10.0% in control). The paper is linked here
# 
# 
# Michelle Cherian
#   17 hours ago
# I can confirm that we are planning to follow-up 3 times during the Phase 1 RCT (i.e once every 4 months over a period of 12 months)
# :pray:
# 1
# 
# 
# 
# Michelle Cherian
#   17 hours ago
# @Akanksha Saletore
#  might have a better idea as to how we went from 80 to 100 to 150 villages. I think it was mostly because we were looking at either UP data or Bihar's data from the Ananya dataset. 
# @Alex Lehner
#  not sure if you remember but can you confirm if you do? (edited) 
# 
# 
# Alex Lehner
# :airplane:  17 hours ago
# Their paper has “all children younger than 5 years residing in households accessing enrolled water points were measured every 2–3 months during a 14-month follow-up period (children could migrate into or out of the cluster). The primary outcome was caregiver-reported child diarrhoea (≥3 loose or watery stools in a 24-h period [WHO criteria]) with a 1-week recall, including all available childhood observations in the analyses.” Do we have a sense for what the NFHS estimate for diarrhea in these areas of Bangladesh are? I am asking because if it turns out that they are similarly somewhere around 5% but Amy finds 10% in control with more frequent surveying, then it seems save to assume a similar scaling up for this rate also for Odisha - which will greatly help with power.
# Also, I checked in the India DHS data for diarrhea but I somehow could not find it, these are the “h11_” columns (in the Nigeria DHS that I checked they are there). If we had that in combination with the geolocalized DHS data, I could check roughly how much residual variation we could partial out with a stratum fixed-effect at some higher geographic level. (edited) 
# 
# 
# Michelle Cherian
#   17 hours ago
# @Alex Lehner
#  We don't have NFHS data for Bangladesh but I checked the DHS 2017-18 data for Bangladesh. The h11 column is available there. But I think Amy surveyed a part of Dhaka and a place called Tongi. Data in DHS is available at the district level so we won't have data for the communities she surveyed.
# Let me check the India DHS data and get back to you
# 
# 
# Michelle Cherian
#   17 hours ago
# @Alex Lehner
#  I have saved the data for child diarrhea for India here- https://drive.google.com/open?id=1emdNi8rt9AMi1uN94_0ncgYg5ihR1n_E&usp=drive_fs
# The h11 variable should now be available. The geocoded data from DHS is also added there
# :raised_hands:
# 1
# 
# 
# 
# Alex Lehner
# :airplane:  16 hours ago
# Thanks a lot Michelle. Will have a look in a bit when I am back on my computer
# 
# 
# Akanksha Saletore
#   10 hours ago
# Hi all,
# Confirming that we will do one baseline and then 3 follow-up surveys in the RCT
# Amy mentioned that in her previous project they ask about diarrhea incidence in the last one week. In previous projects I have worked on, we have asked for the last two weeks. So it will be approximately the same as NFHS
# @Elisa Maffioli
#  the number was initially 80 when we were considering UP. It increased to 100 when we moved to Odisha. In the IRB, I had written this number as 150 to allow for som buffer in case our plans change. But this was purely to give us some slack -- I think we should be considering 100 as the number unless Michael, Amy, and you have discussed otherwise
# 
# 
# 
# 
# 
# Alex Lehner
# :airplane:  10 hours ago
# @Michelle Cherian
# , I saw that it is the raw data which still needs some merging and transformation. I don’t have the capacity right now to do that myself. If you could help create a file that contains the observations for Odisha with the diarrhea outcome + lon & lat coordinates and cluster descriptives, that would be great. If not, no problem. For now, I do the simple randomization only, as Elisa suggested.
# 
# 
# 
# 
# 
# Elisa Maffioli
#   3 hours ago
# @Alex Lehner
#  thanks all. If you could just run a simple randomization at village level that would be great. If you can just send me one paragraph on assumptions/scenarios and results, that would be very helpful to inform our decisions forward on budget. Then, yes, we will have to do some adjustments and I am sure MK will have opinions :slightly_smiling_face: thanks a lot!
# 
# 
# 
# 
# 
# Elisa Maffioli
#   2 hours ago
# @Alex Lehner
#  MK just asked in the call if you can run simple Stata power calcs (No simulations yet), so if you can send us some numbers today, that would be super helpful! Thank you so much!
# 
# 
# 
# 
# 
# Elisa Maffioli
#   2 hours ago
# Just also a note that you will receive a request to join Berkely-Slack so we can have this conversation on the India channel with our collaborators at Berkely. Amy should be part of this conversation so she can advice on assumptions :slightly_smiling_face:                                                                                                                                                                                                     
```


Based on the above we assume a diarrhea rate of 5% with a potential effectsize of 25%.
Number of villages will be 100 (doing also 150) [some average over districts]

```{r}

odishasum_SVSsubs$avg_u5_per_vil <- odishasum_SVSsubs$avg_preg_per_vil * 5
# load estimates from Michelle
#u5distr <- readstata13::read.dta13("under5_districtwise_odisha.dta")
odishasum_SVSsubs$diarrhea_incidence <- c(0.04, 0.05, 0.04, 0.05) # districts alphabetically kalahandi, kandhamal, nabarang, rayagad
# diarrhea comes from this sheet https://docs.google.com/spreadsheets/d/1876Ut6NbNp-tCwECXbtC4v6JQ0V_GG1F/edit#gid=1567497203
num_vil_2_visit <- 100 # acc to Akanksha, 150 from IRB was just to have some slack
odishasum_SVSsubs$MDE_diarrhea_100vil <- NA
for (i in 1:nrow(odishasum_SVSsubs)) {
  print(i)
  odishasum_SVSsubs$MDE_diarrhea_100vil[[i]] <- back_out_MDE_reduction_2proptest_cluster(
    n_cluster = num_vil_2_visit,
    n_per_cluster = odishasum_SVSsubs$avg_u5_per_vil[[i]],
    MR = odishasum_SVSsubs$diarrhea_incidence[[i]], 
    ICC = 0.01) |> round(2)
}

odishasum_SVSsubs$MDE_diarrhea_100vil_90pc <- NA
for (i in 1:nrow(odishasum_SVSsubs)) {
  print(i)
  odishasum_SVSsubs$MDE_diarrhea_100vil_90pc[[i]] <- back_out_MDE_reduction_2proptest_cluster(
    n_cluster = num_vil_2_visit,
    n_per_cluster = odishasum_SVSsubs$avg_u5_per_vil[[i]],
    MR = odishasum_SVSsubs$diarrhea_incidence[[i]], 
    ICC = 0.01,
    power_choice = .9) |> round(2)
}

# ALSO DO FOR 150 villages

odishasum_SVSsubs$avg_u5_per_vil <- odishasum_SVSsubs$avg_preg_per_vil * 5
num_vil_2_visit <- 150 # acc to Akanksha, 150 from IRB was just to have some slack
odishasum_SVSsubs$MDE_diarrhea_150vil <- NA
for (i in 1:nrow(odishasum_SVSsubs)) {
  print(i)
  odishasum_SVSsubs$MDE_diarrhea_150vil[[i]] <- back_out_MDE_reduction_2proptest_cluster(
    n_cluster = num_vil_2_visit,
    n_per_cluster = odishasum_SVSsubs$avg_u5_per_vil[[i]],
    MR = odishasum_SVSsubs$diarrhea_incidence[[i]], 
    ICC = 0.01) |> round(2)
}

odishasum_SVSsubs$MDE_diarrhea_150vil_90pc <- NA
for (i in 1:nrow(odishasum_SVSsubs)) {
  print(i)
  odishasum_SVSsubs$MDE_diarrhea_150vil_90pc[[i]] <- back_out_MDE_reduction_2proptest_cluster(
    n_cluster = num_vil_2_visit,
    n_per_cluster = odishasum_SVSsubs$avg_u5_per_vil[[i]],
    MR = odishasum_SVSsubs$diarrhea_incidence[[i]], 
    ICC = 0.01,
    power_choice = .9) |> round(2)
}


odishasum_SVSsubs




```


Text to be shared with Elisa et. al. and Amy's team:
Hi All, here are the powercalculations on diarrhea I was asked to do. I am out of office and in transit but try to be responsive on slack if there are any questions. The R code is lying on the DIL github (h20-india/reports/power_odisha).
For the four target districts I computed separate, independent MDEs. They all assume that 100 villages are being visited (and the last two columns 150). If you wanted to split across districts, the MDE would then roughly be a weighted average. The variation in MDE comes mostly from the variation in the village sizes across the different districts (have a look at this small app that I wrote to explore some of the village characteristics in more detail).
The assumption on the number of U5 children per village comes from an estimate that we have for the average number of pregnant women per village (out of an NFHS survey). I had no access to an estimate for the number of U5 children, I therefore took the estimate for pregnant women and multiplied it by 5. Please not that this introduces quite a bit of noise in the MDE computations. The MDE here refers to a percent reduction. For example, an MDE of 50 means that we are powered to detect a diarrhea reduction from 5 to 2.5 percent.
The calculations just use standard cluster randomization formulas for simple randomization (clusterPower::cpa.binary() in R). With block-randomization, stratum fixed effects would of course reduce the residual variation and therefore increase power.


```{r}
final_table_print <- odishasum_SVSsubs |> select(dist_name, num_vil_SVS, avg_preg_per_vil, avg_u5_per_vil, diarrhea_incidence, MDE_diarrhea_100vil, MDE_diarrhea_100vil_90pc, MDE_diarrhea_150vil, MDE_diarrhea_150vil_90pc)
final_table_print
```


### NEXT ITERATION: ADD THE TRUE U5 population from the census

We had a population growth in Odisha of roughly 10% since the last census. So without augmenting, we have a conservative estimate. The distribution of U5 children should be roughly the same in 2023 as in 2021.


Above we took the average expected pregnant women and multiplied that by 5. Now I have the actual U5 from the census. People - especially on Amy's team - were worried that this is not a good approximation.



```{r}
# keeping all the rest from above
# now using the actual distribution across villages and using the CV to account for the dispersion (before we just had means)
# so we do the u6 here with pop from 2011 but do not account for population growth. this should kind of give an ok approximation then

num_vil_2_visit <- 100 # acc to Akanksha, 150 from IRB was just to have some slack
odishasum_SVSsubs$MDE_diarrhea_100vil <- NA
for (i in 1:nrow(odishasum_SVSsubs)) {
  print(i)
  odishasum_SVSsubs$MDE_diarrhea_100vil[[i]] <- back_out_MDE_reduction_2proptest_cluster(
    n_cluster = num_vil_2_visit,
    n_per_cluster = odishasum_SVSsubs$avg_u6_per_vil[[i]],
    MR = odishasum_SVSsubs$diarrhea_incidence[[i]],
    CV = odishasum_SVSsubs$CV_u6_per_vil[[i]],
    ICC = 0.01) |> round(2)
}

odishasum_SVSsubs$MDE_diarrhea_100vil_90pc <- NA
for (i in 1:nrow(odishasum_SVSsubs)) {
  print(i)
  odishasum_SVSsubs$MDE_diarrhea_100vil_90pc[[i]] <- back_out_MDE_reduction_2proptest_cluster(
    n_cluster = num_vil_2_visit,
    n_per_cluster = odishasum_SVSsubs$avg_u6_per_vil[[i]],
    MR = odishasum_SVSsubs$diarrhea_incidence[[i]],
    CV = odishasum_SVSsubs$CV_u6_per_vil[[i]],
    ICC = 0.01,
    power_choice = .9) |> round(2)
}

# ALSO DO FOR 150 villages

odishasum_SVSsubs$avg_u5_per_vil <- odishasum_SVSsubs$avg_preg_per_vil * 5
num_vil_2_visit <- 150 # acc to Akanksha, 150 from IRB was just to have some slack
odishasum_SVSsubs$MDE_diarrhea_150vil <- NA
for (i in 1:nrow(odishasum_SVSsubs)) {
  print(i)
  odishasum_SVSsubs$MDE_diarrhea_150vil[[i]] <- back_out_MDE_reduction_2proptest_cluster(
    n_cluster = num_vil_2_visit,
    n_per_cluster = odishasum_SVSsubs$avg_u6_per_vil[[i]],
    MR = odishasum_SVSsubs$diarrhea_incidence[[i]],
    CV = odishasum_SVSsubs$CV_u6_per_vil[[i]],
    ICC = 0.01) |> round(2)
}

odishasum_SVSsubs$MDE_diarrhea_150vil_90pc <- NA
for (i in 1:nrow(odishasum_SVSsubs)) {
  print(i)
  odishasum_SVSsubs$MDE_diarrhea_150vil_90pc[[i]] <- back_out_MDE_reduction_2proptest_cluster(
    n_cluster = num_vil_2_visit,
    n_per_cluster = odishasum_SVSsubs$avg_u6_per_vil[[i]],
    MR = odishasum_SVSsubs$diarrhea_incidence[[i]],
    CV = odishasum_SVSsubs$CV_u6_per_vil[[i]],
    ICC = 0.01,
    power_choice = .9) |> round(2)
}

# HOW MANY VILLAGES TO BE POWERED FOR 25% reduction?
odishasum_SVSsubs$nvil_for_MDE25 <- NA
for (i in 1:nrow(odishasum_SVSsubs)) {
  nclus.out <- clusterPower::cpa.binary(nsubjects = odishasum_SVSsubs$avg_u6_per_vil[[i]], 
                                        CV = odishasum_SVSsubs$CV_u6_per_vil[[i]],
                                        ICC = 0.01, 
                                        p1 = odishasum_SVSsubs$diarrhea_incidence[[i]], 
                                        p2 = odishasum_SVSsubs$diarrhea_incidence[[i]] * .75, 
                                        power = 0.8,
                                          tol = .Machine$double.eps^.5)

  # this is per condition, so we need to double
  odishasum_SVSsubs$nvil_for_MDE25[[i]] <- round(nclus.out) * 2
}

odishasum_SVSsubs

```


Now we print a final table here as well (like above)

```{r}
final_table_print <- odishasum_SVSsubs |> select(dist_name, num_vil_SVS, avg_u6_per_vil, CV_u6_per_vil, diarrhea_incidence, MDE_diarrhea_100vil, MDE_diarrhea_100vil_90pc, MDE_diarrhea_150vil, MDE_diarrhea_150vil_90pc, nvil_for_MDE25pc)
final_table_print
```
